<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDDP - Digital Direct Democracy Platform</title>
    <link rel="icon" href="data:,">
    
    <!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ€åˆã«èª­ã¿è¾¼ã‚€ï¼‰ -->
    <script src="data.js"></script>

    <!-- Reacté–¢é€£ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- CSVãƒ‘ãƒ¼ã‚µãƒ¼ -->
    <script src="https://unpkg.com/papaparse@5.3.0/papaparse.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* ç”»é¢å…¨ä½“ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            margin: 0 auto;
            padding: 0;
            font-size: 12pt;
            color: #000000;
            min-width: 350px;
            max-width: 1000px;
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .menu {
            margin: 2px;
            padding: 2px;
            font-size: 12pt;
            text-align: left;
        }

        /* ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        button {
            padding: 1px;
            border: 1px solid black;
            margin: 2px;
            font-size: 12pt;
            text-align: left;
            background-color: lightblue;
        }

        /* é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        select {
            margin: 2px;
            padding: 1px;
            font-size: 12pt;
            text-align: left;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .title-grid {
            display: grid;
            grid-template-columns: 80px 80px 200px minmax(200px, 1fr) 100px 120px;
            grid-template-rows: auto auto;
            margin: 2px;
            border: 1px solid black;
            min-width: min-content;
        }

        .title-grid div {
            padding: 2px;
            text-align: center;
            border-right: 1px solid black;
            border-bottom: 1px solid black;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ãŠæ°—ã«å…¥ã‚Šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .favorite-menu button {
            width: 25px;
            background-color: white;
        }

        .favorite-menu button.github {
            background-color: mediumseagreen;
        }

        .favorite-menu button.archive {
            background-color: orangered;
        }

        .favorite-menu button.active {
            background-color: khaki;
        }

        /* é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å¹…åˆ¶é™ */
        .genre-select { max-width: 140px; }
        .src-select { max-width: 100px; }
        .sort-select { max-width: 200px; }
        .year-select { max-width: 70px; }
        .area-select { max-width: 130px; }
        .division-select { max-width: 130px; }

        /* ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .menu button {
            width: auto;
            background-color: white;
        }

        .menu button.active {
            background-color: khaki;
        }

        /* ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .data-view {
            margin: 2px;
            padding: 0;
            height: 1200px;
            overflow: auto;
            font-size: 12pt;
        }

        .data-view table {
            width: auto;
            border-collapse: collapse;
            margin: 0;
        }

        .data-view td, .data-view th {
            border: 1px solid black;
            padding: 2px;
            min-width: 15px;
            text-align: left;
            white-space: pre-wrap;
            font-size: 12pt;
            empty-cells: show;
        }

        /* ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        code {
            font-family: monospace;
            font-size: 12pt;
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 2px;
        }

        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .error {
            color: red;
            font-size: 12pt;
            margin: 2px;
            padding: 2px;
        }
    </style>
</head>
<body>
    <!-- åˆæœŸãƒ­ãƒ¼ãƒ‰çŠ¶æ…‹ã®è¡¨ç¤º -->
    <div id="root">
        <div style="color: red; padding: 20px;">
            èª­ã¿è¾¼ã¿ä¸­...ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <script type="text/babel">
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«Reactã‚’é…ç½®
        window.React = React;
        window.ReactDOM = ReactDOM;

        // ----------------------------------
        // 1. ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®å®šç¾©ï¼ˆè«–ç†çš„ãªã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ï¼‰
        // ----------------------------------
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‹•ä½œãƒ¢ãƒ¼ãƒ‰
        let devMode = true;        // @type {boolean} - é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ï¼ˆtrueï¼‰ã‹æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ï¼ˆfalseï¼‰ã‹
        
        // ç”»é¢é·ç§»ã®çŠ¶æ…‹ç®¡ç†
        let page = "p1";          // @type {"p1"|"p2"|"p3"} - ç¾åœ¨ã®ç”»é¢çŠ¶æ…‹
        let url1 = "";           // @type {string} - P1ç”»é¢ã®URLãƒ™ãƒ¼ã‚¹ï¼ˆä¼šè­°ãƒªã‚¹ãƒˆã®ãƒªãƒ³ã‚¯é›†ã®ãƒ‘ã‚¹ã€‚é€šå¸¸ã¯get_githubpages("dddp", "info")ï¼‰
        let url2 = "";           // @type {string} - P2ç”»é¢ã®URLãƒ™ãƒ¼ã‚¹ï¼ˆä¼šè­°ãƒªã‚¹ãƒˆã®ãƒ‘ã‚¹ã€‚GitHubã®å ´åˆã¯get_githubpages(account, repository)ã€Archiveã®å ´åˆã¯get_archivepages_p2()ï¼‰
        let url3 = "";           // @type {string} - P3ç”»é¢ã®URLãƒ™ãƒ¼ã‚¹ï¼ˆä¼šè­°å†…å®¹ã®ãƒ‘ã‚¹ã€‚GitHubã®å ´åˆã¯get_githubpages(account, repository)ã€Archiveã®å ´åˆã¯get_archivepages_p3(repository)ï¼‰
        let fileName1 = "fa.csv"; // @type {string} - P1ç”»é¢ã®è¡¨ç¤ºãƒ•ã‚¡ã‚¤ãƒ«
        let fileName2 = "";      // @type {string} - P2ç”»é¢ã®è¡¨ç¤ºãƒ•ã‚¡ã‚¤ãƒ«
        let fileName3 = "";      // @type {string} - P3ç”»é¢ã®è¡¨ç¤ºãƒ•ã‚¡ã‚¤ãƒ«
        
        // ãƒ‡ãƒ¼ã‚¿ã®åˆ†é¡ã¨è¡¨ç¤ºåˆ¶å¾¡
        let genre = "common";     // @type {"common"|"local"|"school"} - ã‚¸ãƒ£ãƒ³ãƒ«åŒºåˆ†
        let src = "github";       // @type {"github"|"archive"} - ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
        let sort = "YAD";         // @type {"YAD"|"YDA"|"ADY"|"AYD"|"DYA"|"DAY"} - ã‚½ãƒ¼ãƒˆé †
        let subSrc = "";          // @type {""|"a1"|"a2"} - ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æœŸé–“
        
        // ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶
        let year = "";           // @type {string} - å¹´åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆä¾‹: "2025"ï¼‰
        let areaCode = "";       // @type {string} - ã‚¨ãƒªã‚¢ã‚³ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆä¾‹: "JP"ï¼‰
        let division = "";       // @type {string} - åŒºåˆ†ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆä¾‹: "P"ï¼‰

        // ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ç®¡ç†
        let messageErr = "";     // @type {string} - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        let detailMessage = "";  // @type {string} - ã‚¨ãƒ©ãƒ¼è©³ç´°
        
        // ãƒ‡ãƒ¼ã‚¿ã¨çŠ¶æ…‹ç®¡ç†
        let data = [];          // @type {Array<Array<string>>} - CSVãƒ‡ãƒ¼ã‚¿
        let favorites = new Array(10).fill(null);  // @type {Array<Object>} - ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆï¼ˆ10ä»¶åˆ†ï¼‰

        // URLãƒ»ãƒ•ã‚¡ã‚¤ãƒ«é–¢é€£ã®åˆæœŸå€¤ã¯åˆ¥ã®å ´æ‰€ã§è¨­å®šæ¸ˆã¿

        // 1.7 GitHubé–¢é€£
        let account = '';      // GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
        let repository = '';   // GitHubãƒªãƒã‚¸ãƒˆãƒª

        // 1.8 ãŠæ°—ã«å…¥ã‚Šãƒ¢ãƒ¼ãƒ‰é–¢é€£
        let favoriteMode = null;  // null: é€šå¸¸ãƒ¢ãƒ¼ãƒ‰, "heart": è¿½åŠ ãƒ¢ãƒ¼ãƒ‰, "trash": å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰

        // ã‚µãƒ¼ãƒãƒ¼å®šç¾©ã¨URLé–¢é€£ã®å®šæ•°
        const ArchiveServer = "https://dddp.sakura.ne.jp/archive/";
        const LocalServer = "http://127.0.0.1:5500/";
        const YouTube = "https://www.youtube.com/";
        const Github = "https://github.com/";

        // ----------------------------------
        // 2. ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆURLé–¢é€£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰
        // ----------------------------------
        
        const get_githuburl = (account, repository) => `https://github.com/${account}/${repository}/`;
        const get_github = () => {
            if (devMode) {
                return '/';
            } else {
                return 'https://dddp.github.io/home/';
            }
        };
        const get_githubpages = (account, repository) => {
            if (devMode) {
                return `${LocalServer}${repository}/`;
            }
            return `https://${account}.github.io/${repository}/`;
        };
        
        /**
         * csvãƒ•ã‚¡ã‚¤ãƒ«ã®å®Œå…¨ãªURLã‚’å–å¾—ã™ã‚‹é–¢æ•°
         */
        const get_urlTemp = () => get_url() + get_fileName();
        const get_archivepagesBase = () => {
            if (devMode) {
                return `${LocalServer}archive/`;
            } else {
                return `${ArchiveServer}archive/`;
            }
        };
        const get_archivepages_p2 = () => `${get_archivepagesBase()}${genre}/${sort.slice(0, 2)}/`;
        const get_archivepages_p3 = (repository) => `${get_archivepagesBase()}${genre}/${repository.slice(0,5)}/${repository.slice(5,7)}/`;

        // ----------------------------------
        // 3. ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆä¸€èˆ¬ï¼‰ã®å®šç¾©
        // ----------------------------------
        
        /**
         * çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
         * @param {Object} newState - æ–°ã—ã„çŠ¶æ…‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
         * @description ç”»é¢ã®çŠ¶æ…‹å¤‰æ›´ã‚’ä¼´ã†å…¨ã¦ã®å‡¦ç†ã§ä½¿ç”¨ã™ã‚‹ä¸­å¿ƒçš„ãªé–¢æ•°
         */
        const updateState = (newState) => {
            if (newState.page) page = newState.page;
            if (newState.genre) genre = newState.genre;
            if (newState.src) src = newState.src;
            if (newState.subSrc) subSrc = newState.subSrc;
            if (newState.sort) sort = newState.sort;
            if (newState.year) year = newState.year;
            if (newState.areaCode) areaCode = newState.areaCode;
            if (newState.division) division = newState.division;
            if (newState.url1) url1 = newState.url1;
            if (newState.url2) url2 = newState.url2;
            if (newState.url3) url3 = newState.url3;
            if (newState.fileName1) fileName1 = newState.fileName1;
            if (newState.fileName2) fileName2 = newState.fileName2;
            if (newState.fileName3) fileName3 = newState.fileName3;
            if (newState.account) account = newState.account;
            if (newState.repository) repository = newState.repository;
            disp();
        };

        /**
         * CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
         * @description ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’å«ã‚€éåŒæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å‡¦ç†
         */
        const loadCsvData = async () => {
            try {
                // ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
                messageErr = "";
                detailMessage = "";

                // URLã®çµ„ã¿ç«‹ã¦
                const url = get_urlTemp();
                const currentFileName = get_fileName();
                console.log('CSV URL:', url);
                
                if (!url) {
                    throw new Error('URLãŒç”Ÿæˆã§ãã¾ã›ã‚“');
                }

                // ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTPã‚¨ãƒ©ãƒ¼: status ${response.status} - ${response.statusText}`);
                }
                
                // CSVã®ãƒ‘ãƒ¼ã‚¹
                const text = await response.text();
                const results = Papa.parse(text, {
                    header: false,
                    skipEmptyLines: true,
                    error: (error) => {
                        throw new Error(`CSVãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    }
                });
                
                // ãƒ‘ãƒ¼ã‚¹çµæœã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                if (!Array.isArray(results.data)) {
                    throw new Error('CSVãƒ‡ãƒ¼ã‚¿ãŒé…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“');
                }

                if (results.errors && results.errors.length > 0) {
                    const error = results.errors[0];
                    throw new Error(`CSVã‚¨ãƒ©ãƒ¼: ${error.type} at row ${error.row} - ${error.message}`);
                }

                // ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
                data = results.data;
                
            } catch (error) {
                // ã‚¨ãƒ©ãƒ¼å‡¦ç†
                data = [];
                messageErr = "CSV File Read Error";
                detailMessage = `CSVãƒ•ã‚¡ã‚¤ãƒ« '${currentFileName}' ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${error.message}`;
                console.error('CSVãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);

            } finally {
                // UIæ›´æ–°
                disp();
            }
        };

        /**
         * LocalStorageã‹ã‚‰çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
         * @description ãŠæ°—ã«å…¥ã‚Šæƒ…å ±ã®æ°¸ç¶šåŒ–å‡¦ç†
         */
        const loadFromStorage = () => {
            try {
                const storedFavorites = localStorage.getItem('favorites');
                if (storedFavorites) {
                    favorites = JSON.parse(storedFavorites);
                }
                messageErr = '';
                detailMessage = '';
            } catch (error) {
                messageErr = "LocalStorage Read/Write Error";
                detailMessage = `ãŠæ°—ã«å…¥ã‚Šæƒ…å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${error.message}`;
                favorites = [];
            }
        };

        /**
         * LocalStorageã«çŠ¶æ…‹ã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
         * @description ãŠæ°—ã«å…¥ã‚Šæƒ…å ±ã®æ°¸ç¶šåŒ–å‡¦ç†
         */
        const saveToStorage = () => {
            try {
                localStorage.setItem('favorites', JSON.stringify(favorites));
                messageErr = '';
                detailMessage = '';
            } catch (error) {
                messageErr = "LocalStorage Read/Write Error";
                detailMessage = `ãŠæ°—ã«å…¥ã‚Šæƒ…å ±ã®ä¿å­˜ã«å¤±æ•—: ${error.message}`;
                disp();
            }
        };

        // ----------------------------------
        // 4. ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢ä¿‚ï¼‰ã®å®šç¾©
        // ----------------------------------

        /**
         * URLãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°
         * @param {string} urlq - ãƒã‚§ãƒƒã‚¯ã™ã‚‹URL
         * @returns {string} - "Youtube", "GitHub", "Government", "forbidden"ã®ã„ãšã‚Œã‹
         */
        const check_url = (urlq) => {
            if (!urlq) return "forbidden";
            if (urlq.includes("https://www.youtube.com/")) return "Youtube";
            if (urlq.includes("https://github.com/")) return "GitHub";
            if (urlq.includes(".go.jp")) return "Government";
            return "forbidden";
        };

        /**
         * ä¼šè­°ç•ªå·ã‚’å–å¾—ã™ã‚‹é–¢æ•°
         * @returns {string} ä¼šè­°ç•ªå·
         */
        const get_meetingNum = () => {
            const url = get_url();
            const parts = url.split('/');
            return parts[parts.length - 2];
        };

        /**
         * ç¾åœ¨ã®ãƒšãƒ¼ã‚¸åã‚’å–å¾—ã™ã‚‹é–¢æ•°
         * @returns {string} ãƒšãƒ¼ã‚¸å
         */
        const get_pageName = () => {
            switch(page) {
                case "p1": return "List of Meeting List";
                case "p2": return "Meeting List";
                case "p3": return "Meeting";
                default: return "";
            }
        };

        /**
         * ç¾åœ¨ã®URLã‚’å–å¾—ã™ã‚‹é–¢æ•°
         * @returns {string} ç¾åœ¨ã®URL
         */
        const get_url = () => {
            switch(page) {
                case "p1": return url1;
                case "p2": return url2;
                case "p3": return url3;
                default: return "";
            }
        };

        /**
         * ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—ã™ã‚‹é–¢æ•°
         * @returns {string} ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«å
         */
        const get_fileName = () => {
            switch(page) {
                case "p1": return fileName1;
                case "p2": return fileName2;
                case "p3": return fileName3;
                default: return "";
            }
        };

        /**
         * PDCAã‚µã‚¤ã‚¯ãƒ«åŒºåˆ†ã®å–å¾—
         * @returns {string} PDCAã‚µã‚¤ã‚¯ãƒ«åŒºåˆ†ï¼ˆP/D/C/Aï¼‰
         */
        const get_pdca = () => {
            const meetingNum = get_meetingNum();
            if (meetingNum) {
                return meetingNum.slice(11, 12);
            } else {
                return '';
            }
        };

        // ----------------------------------
        // 7. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°ï¼ˆdispï¼‰
        // ----------------------------------

        /**
         * ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°
         * @description ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒã‚¦ãƒ³ãƒˆã¨ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†ã‚’æ‹…å½“
         */
        let rootInstance = null;
        const disp = () => {
            try {
                const rootElement = document.getElementById('root');
                if (!rootElement) {
                    throw new Error('rootè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }

                if (!rootInstance) {
                    rootInstance = ReactDOM.createRoot(rootElement);
                }
                rootInstance.render(React.createElement(App));
            } catch (error) {
                console.error('ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¨ãƒ©ãƒ¼:', error);
                messageErr = 'ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«å¤±æ•—ã—ã¾ã—ãŸ';
                detailMessage = error.toString();
                // æœ€å°é™ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
                const rootElement = document.getElementById('root');
                if (rootElement) {
                    rootElement.innerHTML = `
                        <div style="color: red; padding: 20px;">
                            <h2>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>
                            <p>${messageErr}</p>
                            <p>${detailMessage}</p>
                        </div>
                    `;
                }
            }
        };

        // ----------------------------------
        // 8. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–å‡¦ç†
        // ----------------------------------

        /**
         * åˆæœŸåŒ–é–¢æ•°
         * @description LocalStorageã‹ã‚‰ã®åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¨CSVãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚’è¡Œã†
         */
        const initializeApp = async () => {
            try {
                // ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®ãƒªã‚»ãƒƒãƒˆ
                messageErr = '';
                detailMessage = '';

                // url1ã®åˆæœŸåŒ–
                // < *1: url1 ã®æ±ºå®š >
                url1 = get_githubpages("dddp", "info");
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®å­˜åœ¨ç¢ºèª
                if (typeof years === 'undefined') throw new Error('yearså¤‰æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                if (typeof areaCodes === 'undefined') throw new Error('areaCodeså¤‰æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                if (typeof divisions === 'undefined') throw new Error('divisionså¤‰æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

                // ãŠæ°—ã«å…¥ã‚Šã®åˆæœŸåŒ–
                favorites = Array(10).fill([]);

                // LocalStorageã‹ã‚‰ãŠæ°—ã«å…¥ã‚Šã‚’èª­ã¿è¾¼ã¿
                await loadFromStorage();

                // CSVãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
                await loadCsvData();

            } catch (error) {
                messageErr = 'ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ';
                detailMessage = error.toString();
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            } finally {
                // åˆæœŸè¡¨ç¤º
                disp();
            }
        };

        // DOMContentLoadedã‚’å¾…ã£ã¦åˆæœŸåŒ–ã‚’å®Ÿè¡Œ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // ãŠæ°—ã«å…¥ã‚Šãƒ¢ãƒ¼ãƒ‰å¤‰æ•°ã¯ä¸Šéƒ¨ã§æ—¢ã«å®šç¾©æ¸ˆã¿

        // ----------------------------------
        // 5. ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®šç¾©
        // ----------------------------------
        
        /**
         * ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
         * @description ç”»é¢ä¸Šéƒ¨ã®ã‚¿ã‚¤ãƒˆãƒ«ã¨çŠ¶æ…‹è¡¨ç¤ºã‚’æ‹…å½“
         */
        const TitleScreen = () => {
            return (
                <div className="title-screen" data-src={src}>
                    <div className="title-grid">
                        <div>Title</div>
                        <div>Page</div>
                        <div>Page Name</div>
                        <div>url</div>
                        <div>File Name</div>
                        <div>Error</div>
                        <div>DDDP</div>
                        <div>{page}</div>
                        <div>{get_pageName()}</div>
                        <div>{get_url()}</div>
                        <div>{get_fileName()}</div>
                        <div>{messageErr}</div>
                    </div>
                </div>
            );
        };

        /**
         * ãŠæ°—ã«å…¥ã‚Šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
         */
        const FavoriteMenu = () => {
            /**
             * ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã®ã‚¯ãƒ©ã‚¹ã‚’å–å¾—
             * @param {number} index - ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
             * @returns {string} CSSã‚¯ãƒ©ã‚¹å
             */
            const getFavoriteButtonClass = (index) => {
                if (!favorites[index] || Object.keys(favorites[index]).length === 0) {
                    return "";
                }
                if (favorites[index].src === "github") {
                    return "github";
                } else {
                    return "archive";
                }
            };

            /**
             * ã‚³ãƒ³ãƒ‘ã‚¹ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
             * GitHubãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿åˆæœŸç”»é¢ã«æˆ»ã‚‹
             */
            const handleCompass = () => {
                if (src === "github") {
                    // < *1: url1ã®æ±ºå®š >
                    updateState({
                        genre: "common",
                        src: "github",
                        page: "p1",
                        fileName1: "fa.csv",
                        url1: get_githubpages("dddp", "info")
                    });
                    loadCsvData(); // CSVãƒ‡ãƒ¼ã‚¿ã®å†èª­ã¿è¾¼ã¿ã‚’è¿½åŠ 
                }
            };

            /**
             * æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
             * ç”»é¢é·ç§»ã®å±¥æ­´ã‚’é¡ã‚‹
             */
            const handleBack = () => {
                let newState = {};
                if (page === "p3") {
                    // p3ã‹ã‚‰p2ã¸æˆ»ã‚‹
                    newState = { 
                        page: "p2",
                        url2: url2,  // ç¾åœ¨ã®url2ã‚’ä¿æŒ
                        fileName2: "fa.csv"
                    };
                } else if (page === "p2" && src === "github") {
                    // p2ã‹ã‚‰p1ã¸æˆ»ã‚‹ï¼ˆGitHubãƒ¢ãƒ¼ãƒ‰ã®ã¿ï¼‰
                    newState = { 
                        page: "p1",
                        url1: get_githubpages("dddp", "info"),
                        fileName1: "fa.csv"
                    };
                }
                if (Object.keys(newState).length > 0) {
                    updateState(newState);
                    loadCsvData(); // CSVãƒ‡ãƒ¼ã‚¿ã®å†èª­ã¿è¾¼ã¿ã‚’è¿½åŠ 
                }
            };

            /**
             * ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
             * @param {number} index - ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
             */
            const handleFavoriteClick = (index) => {
                try {
                    if (messageErr && messageErr.includes("LocalStorage")) {
                        messageErr = "ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“";
                        disp();
                        return;
                    }

                    if (favoriteMode === "heart") {
                        // ãŠæ°—ã«å…¥ã‚Šã‚’è¿½åŠ 
                        favorites[index] = {
                            page, genre, src, subSrc, sort, year, areaCode, division,
                            url1, url2, url3, fileName1, fileName2, fileName3
                        };
                        saveToStorage();
                        favoriteMode = null;
                        disp();

                    } else if (favoriteMode === "trash") {
                        // ãŠæ°—ã«å…¥ã‚Šã‚’å‰Šé™¤
                        favorites[index] = [];
                        saveToStorage();
                        favoriteMode = null;
                        disp();

                    } else if (favorites[index] && favorites[index].src === src) {
                        // ãŠæ°—ã«å…¥ã‚Šã‚’èª­ã¿è¾¼ã¿
                        const favorite = favorites[index];
                        updateState(favorite);
                        loadCsvData();
                    }
                } catch (error) {
                    messageErr = "ãŠæ°—ã«å…¥ã‚Šæ“ä½œã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
                    detailMessage = error.toString();
                    disp();
                }
            };

            /**
             * ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
             * @param {string} mode - "heart" ã¾ãŸã¯ "trash"
             */
            const handleModeClick = (mode) => {
                if (favoriteMode === mode) {
                    favoriteMode = null;
                } else {
                    favoriteMode = mode;
                }
                disp();
            };

            return (
                <div className="favorite-menu menu">
                    <button onClick={handleCompass}>ğŸ§­</button>
                    <button 
                        className={getActiveClass("heart", favoriteMode)}
                        onClick={() => handleModeClick("heart")}>â¤ï¸</button>
                    {[...Array(10)].map((_, i) => (
                        <button
                            key={i}
                            className={getFavoriteButtonClass(i)}
                            onClick={() => handleFavoriteClick(i)}
                        >{i + 1}</button>
                    ))}
                    <button 
                        className={getActiveClass("trash", favoriteMode)}
                        onClick={() => handleModeClick("trash")}>ğŸ—‘ï¸</button>
                    <button onClick={handleBack}>â¬…</button>
                </div>
            );
        };

        /**
         * é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
         */
        const SelectionMenu = () => {
            return (
                <div className="menu">
                    <select 
                        className="genre-select" 
                        value={genre}
                        onChange={(e) => updateState({ genre: e.target.value })}>
                        <option value="common">DDDP Common</option>
                        <option value="local">DDDP Local</option>
                        <option value="school">DDDP School</option>
                    </select>

                    <select 
                        className="src-select" 
                        value={src}
                        onChange={(e) => {
                            const value = e.target.value;
                            if (value === "github") {
                                // < *1: url1ã®æ±ºå®š >
                                const newUrl1 = get_githubpages("dddp", "info");
                                updateState({
                                    src: "github",
                                    page: "p1",
                                    url1: newUrl1,
                                    fileName1: "fa.csv"
                                });
                                loadCsvData();
                            } else {
                                updateState({
                                    src: "archive",
                                    page: "p2"
                                });
                            }
                        }}>
                        <option value="github">ğŸŸ©GitHub</option>
                        <option value="archive">ğŸŸ§Archive</option>
                    </select>

                    <select 
                        className="sort-select"
                        value={`${subSrc}:${sort}`}
                        onChange={(e) => {
                            const [period, newSort] = e.target.value.split(":");
                            const newState = {
                                subSrc: period,
                                sort: newSort
                            };
                            
                            if (src === "archive") {
                                // < *2: url2ã®æ±ºå®š >
                                newState.url2 = get_archivepages_p2();
                            }
                            
                            updateState(newState);
                        }}
                        disabled={src !== "archive"}>
                        <optgroup label="Archive a1(y2025-y2029)">
                            <option value="a1:YAD">a1:Year-Area-Div</option>
                            <option value="a1:YDA">a1:Year-Div-Area</option>
                            <option value="a1:ADY">a1:Area-Div-Year</option>
                            <option value="a1:AYD">a1:Area-Year-Div</option>
                            <option value="a1:DYA">a1:Div-Year-Area</option>
                            <option value="a1:DAY">a1:Div-Area-Year</option>
                        </optgroup>
                        <optgroup label="Archive a2(y2030-)">
                            <option value="a2:YAD">a2:Year-Area-Div</option>
                            <option value="a2:YDA">a2:Year-Div-Area</option>
                            <option value="a2:ADY">a2:Area-Div-Year</option>
                            <option value="a2:AYD">a2:Area-Year-Div</option>
                            <option value="a2:DYA">a2:Div-Year-Area</option>
                            <option value="a2:DAY">a2:Div-Area-Year</option>
                        </optgroup>
                    </select>
                </div>
            );
        };

        /**
         * YADãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
         * year, areaCode, division ã®é¸æŠã‚’æ‹…å½“
         */
        const YADMenu = () => {
            /**
             * YADé¸æŠæ™‚ã®å…±é€šå‡¦ç†
             * @param {string} type - "Y", "A", "D" ã®ã„ãšã‚Œã‹
             * @param {string} value - é¸æŠã•ã‚ŒãŸå€¤
             */
            const handleYADSelection = (type, value) => {
                try {
                    const newState = {};
                    
                    // åŸºæœ¬çš„ãªçŠ¶æ…‹æ›´æ–°
                    switch(type) {
                        case 'Y':
                            newState.year = value;
                            break;
                        case 'A':
                            newState.areaCode = value;
                            break;
                        case 'D':
                            newState.division = value;
                            break;
                    }

                    // ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«åæ›´æ–°
                    if (src === "archive" && sort.slice(0, 1) === type) {
                        // < *4: fileName2ã®æ±ºå®š >
                        newState.fileName2 = `${value}.csv`;
                    }

                    updateState(newState);
                    
                    // å¿…è¦ã«å¿œã˜ã¦CSVãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
                    if (src === "archive" && sort.slice(0, 1) === type) {
                        loadCsvData();
                    }

                } catch (error) {
                    messageErr = "YADãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é¸æŠå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
                    detailMessage = error.toString();
                    disp();
                }
            };

            return (
                <div className="menu">
                    {/* Yearé¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ */}
                    <select 
                        className="year-select" 
                        value={year}
                        onChange={(e) => handleYADSelection('Y', e.target.value)}>
                        {years.map(yr => (
                            <option key={yr} value={yr}>{yr}</option>
                        ))}
                    </select>

                    {/* Areaé¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ */}
                    <select 
                        className="area-select" 
                        value={areaCode}
                        onChange={(e) => handleYADSelection('A', e.target.value)}>
                        {areaCodes.map(([code, name]) => (
                            <option key={code} value={code}>{`${code}:${name}`}</option>
                        ))}
                    </select>

                    {/* Divisioné¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ */}
                    <select 
                        className="division-select" 
                        value={division}
                        onChange={(e) => handleYADSelection('D', e.target.value)}>
                        {divisions.map(([code, name]) => (
                            <option key={code} value={code}>{`${code}:${name}`}</option>
                        ))}
                    </select>
                </div>
            );
        };

        /**
         * ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
         */
        const FileMenu = () => {
            /**
             * ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†
             * @param {string} fileName - é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«å
             */
            const handleFileSelect = (fileName) => {
                try {
                    // ç”»é¢çŠ¶æ…‹ã«å¿œã˜ãŸãƒ•ã‚¡ã‚¤ãƒ«åæ›´æ–°
                    let updateNeeded = false;
                    const newState = {};

                    if (page === "p1") {
                        // < *5: fileName1ã®æ±ºå®š >
                        newState.fileName1 = fileName;
                        updateNeeded = true;
                    } else if (page === "p2" && src === "github") {
                        // < *5: fileName2ã®æ±ºå®š >
                        newState.fileName2 = fileName;
                        updateNeeded = true;
                    } else if (page === "p3") {
                        // < *5: fileName3ã®æ±ºå®š >
                        newState.fileName3 = fileName;
                        updateNeeded = true;
                    }

                    if (updateNeeded) {
                        updateState(newState);
                        loadCsvData();
                    }

                } catch (error) {
                    messageErr = "ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
                    detailMessage = error.toString();
                    disp();
                }
            };

            /**
             * usage/surveyãƒªãƒ³ã‚¯ã‚’é–‹ã
             * @param {string} type - "usage" ã¾ãŸã¯ "survey"
             */
            const handleLinkClick = (type) => {
                try {
                    let url;
                    if (type === "usage") {
                        url = `${get_archive()}home/usage${page}.html`;
                    } else if (type === "survey" && page === "p3") {
                        const meetingNum = get_meetingNum();
                        url = `${get_archive()}survey/${genre}/${meetingNum.slice(0,5)}/${meetingNum}.html`;
                    }
                    if (url) {
                        window.open(url, '_blank');
                    }
                } catch (error) {
                    messageErr = "ãƒªãƒ³ã‚¯å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
                    detailMessage = error.toString();
                    disp();
                }
            };

            /**
             * surveyãƒœã‚¿ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹é–¢æ•°
             * @returns {JSX.Element|null}
             */
            const renderSurveyButton = () => {
                if (page === "p3") {
                    return <button onClick={() => handleLinkClick("survey")}>survey</button>;
                }
                return null;
            };

            /**
             * ãƒœã‚¿ãƒ³ã®ã‚¯ãƒ©ã‚¹åã‚’å–å¾—
             * @param {string} fileName - ãƒœã‚¿ãƒ³ã«å¯¾å¿œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å
             * @returns {string} CSSã‚¯ãƒ©ã‚¹å
             */
            const getButtonClass = (fileName) => {
                const currentFile = get_fileName();
                return getActiveClass(fileName, currentFile);
            };

            return (
                <div className="menu">
                    <button 
                        className={getButtonClass("fa.csv")}
                        onClick={() => handleFileSelect("fa.csv")}>Main</button>
                    <button 
                        className={getButtonClass("fb.csv")}
                        onClick={() => handleFileSelect("fb.csv")}>Sub</button>
                    <button 
                        className={getButtonClass("fn.csv")}
                        onClick={() => handleFileSelect("fn.csv")}>News</button>
                    <button 
                        className={getButtonClass("fr.csv")}
                        onClick={() => handleFileSelect("fr.csv")}>Docs</button>
                    <button onClick={() => handleLinkClick("usage")}>usage</button>
                    {renderSurveyButton()}
                </div>
            );
        };

        /**
         * ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
         * @description CSVãƒ‡ãƒ¼ã‚¿ã‚’è¡¨å½¢å¼ã§è¡¨ç¤ºã—ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªè¦ç´ ã‚’å‡¦ç†
         */
        const DataDisplay = () => {
            /**
             * åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¤œç´¢ã™ã‚‹é–¢æ•°
             * @param {Array} headers - ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
             * @param {string} columnName - æ¤œç´¢ã™ã‚‹åˆ—å
             * @returns {number} åˆ—ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
             */
            const findColumnIndex = (headers, columnName) => {
                return headers.findIndex(header => header === columnName);
            };

            /**
             * GitHubãƒšãƒ¼ã‚¸ã¸ã®é·ç§»ã‚’å‡¦ç†ã™ã‚‹é–¢æ•°
             * @param {string} account - GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
             * @param {string} repository - ãƒªãƒã‚¸ãƒˆãƒªå
             */
            const handleGitHubPage = (account, repository) => {
                try {
                    // < *3: url3ã®æ±ºå®š >
                    const newUrl2 = get_githubpages(account, repository);
                    if (!newUrl2) {
                        throw new Error('GitHubãƒšãƒ¼ã‚¸ã®URLã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }

                    updateState({
                        page: "p2",
                        url2: newUrl2,
                        fileName2: "fa.csv",
                        account: account,
                        repository: repository
                    });
                    loadCsvData();
                } catch (error) {
                    messageErr = 'GitHubãƒšãƒ¼ã‚¸ã¸ã®é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ';
                    detailMessage = error.toString();
                    disp();
                }
            };

            /**
             * ãƒªãƒã‚¸ãƒˆãƒªãƒšãƒ¼ã‚¸ã¸ã®é·ç§»ã‚’å‡¦ç†ã™ã‚‹é–¢æ•°
             * @param {string} account - GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
             * @param {string} repository - ãƒªãƒã‚¸ãƒˆãƒªå
             */
            const handleRepositoryPage = (account, repository) => {
                try {
                    let newUrl3;
                    if (src === "github") {
                        newUrl3 = get_githubpages(account, repository);
                    } else {
                        newUrl3 = get_archivepages_p3(repository);
                    }

                    if (!newUrl3) {
                        throw new Error('ãƒªãƒã‚¸ãƒˆãƒªãƒšãƒ¼ã‚¸ã®URLã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }

                    updateState({
                        page: "p3",
                        fileName3: "fa.csv",
                        url3: newUrl3,
                        account: account,
                        repository: repository
                    });
                    loadCsvData();
                } catch (error) {
                    messageErr = 'ãƒªãƒã‚¸ãƒˆãƒªãƒšãƒ¼ã‚¸ã¸ã®é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ';
                    detailMessage = error.toString();
                    disp();
                }
            };

            /**
             * ã‚»ãƒ«ã®å†…å®¹ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹é–¢æ•°
             * @param {string} cell - ã‚»ãƒ«ã®å†…å®¹
             * @param {number} rowIndex - è¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
             * @param {number} colIndex - åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
             * @returns {JSX.Element} ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸã‚»ãƒ«
             */
            const renderCell = (cell, rowIndex, colIndex) => {
                // åŸºæœ¬çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                if (!data || !data[0]) {
                    let displayValue = '';
                    if (cell) {
                        displayValue = cell;
                    }
                    return <td key={colIndex}>{displayValue}</td>;
                }
                if (!cell) return <td key={colIndex}>{''}</td>;

                const headers = data[0];
                const isHeader = rowIndex === 0;

                // URLã®å‡¦ç†
                if (cell.startsWith('http')) {
                    const result = check_url(cell);
                    const content = result !== "forbidden"
                        ? <a href={cell} target="_blank" rel="noopener noreferrer">{result}</a>
                        : "<forbidden URL>";
                    return <td key={colIndex}>{content}</td>;
                }

                // P1ãƒšãƒ¼ã‚¸ã®ã‚»ãƒ«å‡¦ç†
                if (page === "p1" && !isHeader) {
                    const isAccountCell = headers[colIndex] === genre;
                    const isAreaNameCell = headers[colIndex] === "Area_Name";
                    const isCodeCell = headers[colIndex] === "Code";
                    const accountColIndex = findColumnIndex(headers, genre);
                    const account = data[rowIndex][accountColIndex];

                    // Codeã‚»ãƒ«ã®ã‚¿ã‚°å‡¦ç†
                    if (isCodeCell) {
                        return <td key={colIndex}><code>{cell}</code></td>;
                    }

                    if (isAccountCell) {
                        return (
                            <td key={colIndex}>
                                <button onClick={() => handleGitHubPage(cell, `home${genre}`)}>
                                    {cell}
                                </button>
                            </td>
                        );
                    }

                    if (isAreaNameCell && account) {
                        return (
                            <td key={colIndex}>
                                <a 
                                    href={get_githuburl(account, `home${genre}`)}
                                    target="_blank"
                                    rel="noopener noreferrer">
                                    {cell}
                                </a>
                            </td>
                        );
                    }
                }

                // P2ãƒšãƒ¼ã‚¸ã®ã‚»ãƒ«å‡¦ç†
                if (page === "p2" && !isHeader) {
                    const isRepositoryCell = headers[colIndex] === "repository";
                    const isAccountCell = headers[colIndex] === "account";
                    const accountColIndex = findColumnIndex(headers, "account");
                    const repositoryColIndex = findColumnIndex(headers, "repository");
                    const account = data[rowIndex][accountColIndex];
                    const repository = data[rowIndex][repositoryColIndex];

                    if (isRepositoryCell) {
                        return (
                            <td key={colIndex}>
                                <button onClick={() => handleRepositoryPage(account, cell)}>
                                    {cell}
                                </button>
                            </td>
                        );
                    }

                    if (isAccountCell && src === "github") {
                        return (
                            <td key={colIndex}>
                                <a 
                                    href={get_githuburl(cell, repository)}
                                    target="_blank"
                                    rel="noopener noreferrer">
                                    {cell}
                                </a>
                            </td>
                        );
                    }
                }

                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚»ãƒ«è¡¨ç¤º
                return <td key={colIndex}>{cell}</td>;
            };

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¡¨ç¤º
            if (!data) {
                return <div className="data-view">èª­ã¿è¾¼ã¿ä¸­...</div>;
            }

            // ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®è¡¨ç¤º
            if (messageErr) {
                return (
                    <div className="data-view">
                        <div className="error">
                            {messageErr}
                            {renderDetailMessage()}
                            {detailMessage}
                        </div>
                    </div>
                );
            }

            // ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡¨ç¤º
            return (
                <div className="data-view">
                    <table>
                        <tbody>
                            {data.map((row, i) => (
                                <tr key={i}>
                                    {row.map((cell, j) => renderCell(cell, i, j))}
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        };

        /**
         * è©³ç´°ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹é–¢æ•°
         * @returns {JSX.Element|null}
         */
        const renderDetailMessage = () => {
            if (detailMessage) {
                return <div>{detailMessage}</div>;
            }
            return null;
        };

        /**
         * ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
         * @description å…¨ç”»é¢ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆæˆã—ã€ç”»é¢ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’åˆ¶å¾¡
         */
        const App = () => {
            return (
                <div className="app-container">
                    <TitleScreen />
                    <FavoriteMenu />
                    <SelectionMenu />
                    <YADMenu />
                    <FileMenu />
                    <DataDisplay />
                    <div className="error" style={{display: messageErr ? 'block' : 'none'}}>
                        <div>{messageErr}</div>
                        {renderDetailMessage()}
                    </div>
                </div>
            );
        };

        /**
         * ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¹ã‚’å–å¾—ã™ã‚‹é–¢æ•°
         * @param {string} target - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒ¢ãƒ¼ãƒ‰ï¼ˆ"heart" ã¾ãŸã¯ "trash"ï¼‰
         * @param {string} currentMode - ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰
         * @returns {string} - "active" ã¾ãŸã¯ ""
         */
        const getActiveClass = (target, currentMode) => {
            if (currentMode === target) {
                return "active";
            } else {
                return "";
            }
        };

        // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
        // ã“ã‚Œã¯å”¯ä¸€ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        window.App = App;


    </script>
</body>
</html>
